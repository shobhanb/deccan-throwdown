<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button
        [defaultHref]="['/admin', 'scores', wodNumber()]"
      ></ion-back-button>
    </ion-buttons>
    <ion-title>Edit Score</ion-title>
    <app-toolbar-buttons slot="end"></app-toolbar-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  @if (dataLoaded()) {

  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ teamData()?.team_name }} </ion-card-title>
      <ion-card-subtitle
        >{{ `WOD ${wod()?.wodNumber}: ${wod()?.wodName}` }}</ion-card-subtitle
      >
    </ion-card-header>
    <ion-card-content>
      @if (isVerified()) {
      <ion-text>This score is verified. Editing is disabled.</ion-text>
      } @else {
      <ion-text>This score is not verified.</ion-text>
      }
    </ion-card-content>
  </ion-card>

  <form [formGroup]="scoreForm" (ngSubmit)="submitScore()">
    <ion-list [inset]="true">
      <ion-item>
        <ion-input
          type="number"
          label="Reps or weight"
          labelPlacement="stacked"
          formControlName="reps"
          placeholder="Enter number of reps or weight"
        ></ion-input>
      </ion-item>

      <ion-item>
        <ion-input
          type="number"
          label="Time (Minutes)"
          labelPlacement="stacked"
          formControlName="time_minutes"
        ></ion-input>

        <ion-input
          type="number"
          label="Time (Seconds)"
          labelPlacement="stacked"
          formControlName="time_seconds"
          min="0"
          max="59"
        ></ion-input>
      </ion-item>

      <ion-item>
        <ion-input
          type="number"
          label="Tiebreak (Minutes)"
          labelPlacement="stacked"
          formControlName="tiebreak_minutes"
        ></ion-input>

        <ion-input
          type="number"
          label="Tiebreak (Seconds)"
          labelPlacement="stacked"
          formControlName="tiebreak_seconds"
          min="0"
          max="59"
        ></ion-input>
      </ion-item>

      <ion-item>
        <ion-textarea
          label="Score Detail"
          labelPlacement="stacked"
          formControlName="score_detail"
          placeholder="Enter additional score details"
          rows="4"
          autoGrow="true"
        ></ion-textarea>
      </ion-item>
    </ion-list>

    @if (!isVerified()) {
    <ion-button
      expand="block"
      class="ion-margin"
      type="submit"
      [disabled]="!scoreFormValid()"
      >{{ isEditing() ? "Update Score" : "Submit Score" }}</ion-button
    >
    }

    <ion-button
      expand="block"
      fill="outline"
      class="ion-margin"
      type="button"
      [routerLink]="['/admin', 'scores', wodNumber()]"
      routerDirection="back"
      >Cancel</ion-button
    >
  </form>

  @if (isEditing() && !isVerified()) {
  <ion-button
    expand="block"
    class="ion-margin"
    type="button"
    color="danger"
    (click)="onDelete()"
    >Delete</ion-button
  >
  } } @else {
  <!-- Loading skeleton for edit page -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-skeleton-text
          [animated]="true"
          style="width: 60%; height: 20px"
        ></ion-skeleton-text>
      </ion-card-title>
      <ion-card-subtitle>
        <ion-skeleton-text
          [animated]="true"
          style="width: 80%; height: 16px"
        ></ion-skeleton-text>
      </ion-card-subtitle>
    </ion-card-header>
  </ion-card>

  <!-- Loading skeleton for form -->
  <ion-list [inset]="true">
    @for (item of [1, 2, 3, 4, 5]; track $index) {
    <ion-item>
      <ion-skeleton-text
        [animated]="true"
        style="width: 100%; height: 48px"
      ></ion-skeleton-text>
    </ion-item>
    }
  </ion-list>

  <!-- Loading skeleton for buttons -->
  <ion-skeleton-text
    [animated]="true"
    style="width: 100%; height: 48px; margin: 16px; border-radius: 8px"
  ></ion-skeleton-text>
  <ion-skeleton-text
    [animated]="true"
    style="width: 100%; height: 48px; margin: 16px; border-radius: 8px"
  ></ion-skeleton-text>
  }
</ion-content>

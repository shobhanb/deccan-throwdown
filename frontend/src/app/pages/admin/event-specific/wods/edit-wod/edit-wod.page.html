<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button
        [defaultHref]="['/admin', eventShortName(),'wods']"
      ></ion-back-button>
    </ion-buttons>
    <ion-title>{{ isEditing() ? "Edit WOD" : "Create WOD" }}</ion-title>
    <app-toolbar-buttons slot="end"></app-toolbar-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  @if (dataLoaded()) {

  <div class="section-title">{{ eventName()}}</div>
  <form [formGroup]="wodForm" (ngSubmit)="onSubmit()">
    <ion-list [inset]="true">
      <ion-item>
        <ion-input
          type="number"
          label="WOD Number"
          labelPlacement="stacked"
          formControlName="wod_number"
          placeholder="Enter WOD number (1, 2, 3, etc.)"
        ></ion-input>
      </ion-item>
      @if (getFieldError('wod_number')) {
      <ion-note color="danger" class="ion-margin-start">
        {{ getFieldError('wod_number') }}
      </ion-note>
      }

      <ion-item>
        <ion-input
          type="text"
          label="WOD Name"
          labelPlacement="stacked"
          formControlName="wod_name"
          placeholder="Enter WOD name"
        ></ion-input>
      </ion-item>
      @if (getFieldError('wod_name')) {
      <ion-note color="danger" class="ion-margin-start">
        {{ getFieldError('wod_name') }}
      </ion-note>
      }

      <ion-item>
        <ion-select
          label="Score Type"
          labelPlacement="stacked"
          formControlName="wod_score_type"
          placeholder="Select scoring method"
        >
          @for (scoreType of scoreTypes; track scoreType) {
          <ion-select-option [value]="scoreType"
            >{{ scoreType }}</ion-select-option
          >
          }
        </ion-select>
      </ion-item>
      @if (getFieldError('wod_score_type')) {
      <ion-note color="danger" class="ion-margin-start">
        {{ getFieldError('wod_score_type') }}
      </ion-note>
      }

      <ion-item>
        <ion-textarea
          label="WOD Description"
          labelPlacement="stacked"
          formControlName="wod_description"
          placeholder="Enter WOD description"
          rows="8"
          autoGrow="true"
        ></ion-textarea>
      </ion-item>
      @if (getFieldError('wod_description')) {
      <ion-note color="danger" class="ion-margin-start">
        {{ getFieldError('wod_description') }}
      </ion-note>
      }
    </ion-list>

    <ion-button
      expand="block"
      class="ion-margin"
      type="submit"
      [disabled]="!isFormValid()"
      >{{ isEditing() ? "Update WOD" : "Create WOD" }}</ion-button
    >

    <ion-button
      expand="block"
      fill="outline"
      class="ion-margin"
      type="button"
      (click)="onCancel()"
      >Cancel</ion-button
    >
  </form>

  <ion-button
    expand="block"
    class="ion-margin"
    color="danger"
    type="button"
    (click)="onDelete()"
    >Delete</ion-button
  >

  } @else {

  <!-- Loading skeleton for edit page -->
  <ion-card>
    <ion-card-header>
      <ion-skeleton-text
        [animated]="true"
        style="width: 200px; height: 24px"
      ></ion-skeleton-text>
    </ion-card-header>
    <ion-card-content>
      <ion-skeleton-text
        [animated]="true"
        style="width: 300px; height: 16px"
      ></ion-skeleton-text>
    </ion-card-content>
  </ion-card>

  <div class="section-title">
    <ion-skeleton-text
      [animated]="true"
      style="width: 150px; height: 20px"
    ></ion-skeleton-text>
  </div>

  <ion-list [inset]="true">
    @for (item of [1, 2, 3, 4, 5]; track $index) {
    <ion-item>
      <ion-skeleton-text
        [animated]="true"
        style="width: 100%; height: 48px"
      ></ion-skeleton-text>
    </ion-item>
    }
  </ion-list>

  <ion-skeleton-text
    [animated]="true"
    style="width: 100%; height: 48px; margin: 16px; border-radius: 8px"
  ></ion-skeleton-text>
  <ion-skeleton-text
    [animated]="true"
    style="width: 100%; height: 48px; margin: 16px; border-radius: 8px"
  ></ion-skeleton-text>

  }
</ion-content>

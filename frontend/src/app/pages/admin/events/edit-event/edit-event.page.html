<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/events"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ isEditing() ? "Edit Event" : "Create Event" }}</ion-title>
    <app-toolbar-buttons slot="end"></app-toolbar-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  @if (dataLoaded()) {

  <form [formGroup]="eventForm" (ngSubmit)="onSubmit()">
    <ion-list [inset]="true">
      <ion-item>
        <ion-input
          type="text"
          label="Event Name"
          labelPlacement="stacked"
          formControlName="event_name"
          placeholder="Enter event name"
        ></ion-input>
      </ion-item>
      <ion-item>
        <ion-input
          type="text"
          label="Event Short Name"
          labelPlacement="stacked"
          formControlName="event_short_name"
          placeholder="Enter event short name (no spaces)"
        ></ion-input>
      </ion-item>
      @if (getFieldError('event_short_name')) {
      <ion-note color="danger" class="ion-margin-start">
        {{ getFieldError('event_short_name') }}
      </ion-note>
      }
      <ion-item>
        <ion-input
          type="number"
          label="Athletes Per Team"
          labelPlacement="stacked"
          formControlName="athletes_per_team"
          placeholder="Enter number of athletes per team"
        ></ion-input>
      </ion-item>
      <ion-item>
        <ion-input
          type="text"
          label="Organization"
          labelPlacement="stacked"
          formControlName="organization_name"
          placeholder="Enter organization name"
        ></ion-input>
      </ion-item>
      <ion-item>
        <ion-input
          type="text"
          label="City"
          labelPlacement="stacked"
          formControlName="city"
          placeholder="Enter city"
        ></ion-input>
      </ion-item>
      <ion-item>
        <ion-input
          type="text"
          label="Country"
          labelPlacement="stacked"
          formControlName="country"
          placeholder="Enter country"
        ></ion-input>
      </ion-item>
      <ion-item>
        <ion-input
          type="number"
          label="Year"
          labelPlacement="stacked"
          formControlName="year"
          placeholder="Enter year"
        ></ion-input>
      </ion-item>
      <ion-item>
        <ion-input
          type="date"
          label="Start Date"
          labelPlacement="stacked"
          formControlName="start_date"
        ></ion-input>
      </ion-item>
      <ion-item>
        <ion-input
          type="date"
          label="End Date"
          labelPlacement="stacked"
          formControlName="end_date"
        ></ion-input>
      </ion-item>
    </ion-list>

    <ion-button
      expand="block"
      class="ion-margin"
      type="submit"
      [disabled]="!isFormValid()"
      >{{ isEditing() ? "Update Event" : "Create Event" }}</ion-button
    >

    <ion-button
      expand="block"
      fill="outline"
      class="ion-margin"
      type="button"
      (click)="onCancel()"
      >Cancel</ion-button
    >
  </form>
  } @else {
  <!-- Loading skeleton for edit page -->
  <ion-card>
    <ion-card-header>
      <ion-skeleton-text
        [animated]="true"
        style="width: 200px; height: 24px"
      ></ion-skeleton-text>
    </ion-card-header>
    <ion-card-content>
      <ion-skeleton-text
        [animated]="true"
        style="width: 300px; height: 16px"
      ></ion-skeleton-text>
    </ion-card-content>
  </ion-card>

  <div class="section-title">
    <ion-skeleton-text
      [animated]="true"
      style="width: 150px; height: 20px"
    ></ion-skeleton-text>
  </div>

  <ion-list [inset]="true">
    @for (item of [1, 2, 3, 4, 5, 6, 7]; track $index) {
    <ion-item>
      <ion-skeleton-text
        [animated]="true"
        style="width: 100%; height: 48px"
      ></ion-skeleton-text>
    </ion-item>
    }
  </ion-list>

  <ion-skeleton-text
    [animated]="true"
    style="width: 100%; height: 48px; margin: 16px; border-radius: 8px"
  ></ion-skeleton-text>
  <ion-skeleton-text
    [animated]="true"
    style="width: 100%; height: 48px; margin: 16px; border-radius: 8px"
  ></ion-skeleton-text>
  }
</ion-content>
